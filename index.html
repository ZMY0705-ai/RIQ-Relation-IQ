<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RelationIQ - ÂÖ≥Á≥ªËØÑ‰º∞Á≥ªÁªü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>‚ù§Ô∏è</text></svg>">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#9A8C98',
                        secondary: '#C9ADA7',
                        accent: '#4A4E69',
                        background: '#F2E9E4',
                        text: '#22223B',
                        success: '#A7C4A0',
                        warning: '#E6B89C',
                        danger: '#D4A5A5'
                    }
                }
            }
        }
    </script>
    <style>
        /* Âü∫Á°ÄÊ†∑Âºè */
        .sidebar {
            width: 250px;
            transition: all 0.3s;
            background-color: #4A4E69;
        }
        .main-content {
            margin-left: 250px;
            transition: all 0.3s;
            background-color: #F2E9E4;
        }
        .collapsed .sidebar {
            width: 70px;
        }
        .collapsed .main-content {
            margin-left: 70px;
        }
        .drawer {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .drawer.open {
            transform: translateX(0);
        }
        .profile-card {
            transition: all 0.2s ease;
            background-color: white;
        }
        .profile-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .risk-high {
            background-color: #FADBD8;
            color: #C0392B;
        }
        .risk-medium {
            background-color: #FCF3CF;
            color: #D68910;
        }
        .risk-low {
            background-color: #D5F5E3;
            color: #239B56;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .star-rating button {
            font-size: 1.2rem;
            transition: color 0.2s;
        }
        .star-rating button.active {
            color: #F39C12;
        }
        .criteria-item {
            transition: all 0.2s;
        }
        .criteria-item:hover {
            background-color: #f9fafb;
        }
        .radar-chart-container {
            height: 250px;
        }
        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-right: 3px solid #9A8C98;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background-color: #9A8C98;
            color: white;
        }
        .btn-primary:hover {
            background-color: #8A7C88;
        }
        .btn-secondary {
            background-color: #C9ADA7;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #B99D97;
        }
        .section-title {
            color: #4A4E69;
            border-left: 4px solid #9A8C98;
            padding-left: 12px;
        }
        .sub-criteria {
            margin-left: 20px;
            border-left: 2px solid #E2E8F0;
            padding-left: 15px;
        }
        .dragging {
            opacity: 0.6;
        }
        .delete-btn {
            transition: all 0.2s;
        }
        .delete-btn:hover {
            background-color: #EF4444;
            color: white;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }
            .main-content {
                margin-left: 60px;
                padding: 10px;
            }
            .collapsed .sidebar {
                width: 0;
            }
            .collapsed .main-content {
                margin-left: 0;
            }
            .nav-text {
                display: none;
            }
            .nav-item {
                justify-content: center;
                padding: 12px 0;
            }
            .nav-item i {
                margin-right: 0;
            }
            #profiles-page h1 {
                font-size: 1.5rem;
            }
            .grid {
                grid-template-columns: 1fr !important;
            }
            .drawer {
                width: 100%;
                max-width: 100%;
            }
            .profile-card {
                margin-bottom: 15px;
            }
            button, .btn-primary, .btn-secondary {
                min-height: 44px;
                padding: 10px 16px;
            }
            input, textarea, select {
                font-size: 16px; /* Èò≤Ê≠¢iOSÁº©Êîæ */
            }
            .radar-chart-container {
                height: 200px;
            }
        }
        
        @media (max-width: 480px) {
            .main-content {
                padding: 8px;
            }
            .card {
                padding: 15px;
            }
            .tabs {
                font-size: 12px;
            }
            .tab-btn {
                padding: 8px 12px;
            }
        }
        
        /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) {
            .profile-card:hover {
                transform: none;
            }
            .criteria-item:hover {
                background-color: transparent;
            }
        }
    </style>
</head>
<body class="bg-background text-text">
    <!-- Â∫îÁî®ÂÆπÂô® -->
    <div class="app-container min-h-screen flex">
        <!-- ‰æßËæπÊ†èÂØºËà™ -->
        <div class="sidebar text-white fixed h-full overflow-y-auto z-10">
            <div class="p-4 border-b border-gray-600">
                <div class="flex items-center justify-between">
                    <h1 class="text-xl font-bold hidden md:block">RelationIQ</h1>
                    <h1 class="text-xl font-bold md:hidden">RIQ</h1>
                    <button class="toggle-sidebar p-1 rounded hover:bg-gray-700 text-white">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
            
            <nav class="mt-6">
                <a href="#" class="nav-item active flex items-center px-4 py-3 text-white hover:bg-gray-700" data-page="profiles">
                    <i class="fas fa-users w-6 text-center mr-3"></i>
                    <span class="nav-text">ÂØπË±°Â∫ì</span>
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white hover:bg-gray-700" data-page="personal">
                    <i class="fas fa-user w-6 text-center mr-3"></i>
                    <span class="nav-text">‰∏™‰∫∫‰∏≠ÂøÉ</span>
                </a>
            </nav>
            
            <div class="mt-8 px-4">
                <h3 class="text-xs font-semibold text-gray-300 uppercase tracking-wide mb-2 hidden md:block">Âø´Êç∑Êìç‰Ωú</h3>
                <button class="w-full bg-secondary text-white py-2 rounded-md text-sm font-medium flex items-center justify-center mb-2">
                    <i class="fas fa-download mr-2"></i> <span class="hidden md:inline">ÂØºÂá∫Êï∞ÊçÆ</span>
                </button>
                <button class="w-full bg-gray-700 text-white py-2 rounded-md text-sm font-medium flex items-center justify-center">
                    <i class="fas fa-upload mr-2"></i> <span class="hidden md:inline">ÂØºÂÖ•Êï∞ÊçÆ</span>
                </button>
            </div>
        </div>
        
        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="main-content flex-1 p-6">
            <!-- ÂØπË±°Â∫ìÈ°µÈù¢ -->
            <div id="profiles-page" class="page active">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold">ÂØπË±°Â∫ì</h1>
                    <div class="flex space-x-2">
                        <div class="relative hidden md:block">
                            <input type="text" placeholder="ÊêúÁ¥¢ÂØπË±°..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <select id="sort-profiles" class="border border-gray-300 rounded-md focus:ring-primary focus:border-primary py-2 px-3">
                            <option value="score-desc">ÊåâÂæóÂàÜ‰ªéÈ´òÂà∞‰Ωé</option>
                            <option value="score-asc">ÊåâÂæóÂàÜ‰ªé‰ΩéÂà∞È´ò</option>
                            <option value="date-desc">ÊåâÊ∑ªÂä†Êó∂Èó¥‰ªéÊñ∞Âà∞Êóß</option>
                            <option value="date-asc">ÊåâÊ∑ªÂä†Êó∂Èó¥‰ªéÊóßÂà∞Êñ∞</option>
                            <option value="custom">Ëá™ÂÆö‰πâÊéíÂ∫è</option>
                        </select>
                        <button class="btn-primary px-4 py-2 rounded-md flex items-center" id="add-profile-btn">
                            <i class="fas fa-plus mr-2"></i> <span class="hidden md:inline">Êñ∞Âª∫ÂØπË±°</span>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="profiles-container">
                    <!-- ÂØπË±°Âç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <!-- Á©∫Áä∂ÊÄÅ -->
                <div id="empty-state" class="text-center py-12">
                    <div class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-plus text-gray-500 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">ÊöÇÊó†ËØÑ‰º∞ÂØπË±°</h3>
                    <p class="text-gray-600 mb-6">ÁÇπÂáª"Êñ∞Âª∫ÂØπË±°"ÊåâÈíÆÊ∑ªÂä†Á¨¨‰∏Ä‰∏™ËØÑ‰º∞ÂØπË±°</p>
                    <button class="btn-primary px-4 py-2 rounded-md font-medium" id="empty-add-btn">
                        <i class="fas fa-plus mr-2"></i> Êñ∞Âª∫ÂØπË±°
                    </button>
                </div>
            </div>
            
            <!-- ‰∏™‰∫∫‰∏≠ÂøÉÈ°µÈù¢ -->
            <div id="personal-page" class="page">
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-2xl font-bold mb-6">‰∏™‰∫∫‰∏≠ÂøÉ</h1>
                    
                    <div class="space-y-6">
                        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                        <div class="card p-6">
                            <h2 class="section-title text-lg font-semibold mb-4">
                                <i class="fas fa-id-card text-primary mr-2"></i>
                                Âü∫Êú¨‰ø°ÊÅØ
                            </h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">ÂßìÂêç</label>
                                    <input type="text" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" placeholder="ÊÇ®ÁöÑÂßìÂêç" id="personal-name">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Âπ¥ÈæÑ</label>
                                    <input type="number" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" placeholder="Âπ¥ÈæÑ" id="personal-age">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium mb-1">ÁêÜÊÉ≥‰º¥‰æ£ÊèèËø∞</label>
                                    <textarea class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="3" placeholder="ÊèèËø∞ÊÇ®ÁêÜÊÉ≥‰∏≠ÁöÑ‰º¥‰æ£..." id="personal-ideal"></textarea>
                                </div>
                            </div>
                            
                            <button class="mt-4 btn-primary px-4 py-2 rounded-md text-sm font-medium" id="save-personal-info">
                                <i class="fas fa-save mr-1"></i> ‰øùÂ≠òÂü∫Êú¨‰ø°ÊÅØ
                            </button>
                        </div>
                        
                        <!-- Ëá™ÊàëËØÑ‰º∞ -->
                        <div class="card p-6">
                            <h2 class="section-title text-lg font-semibold mb-4">
                                <i class="fas fa-chart-line text-primary mr-2"></i>
                                Ëá™ÊàëËØÑ‰º∞
                            </h2>
                            
                            <div class="mb-6">
                                <h3 class="font-medium mb-2">Êã©ÂÅ∂‰ºòÂäø‰∏éÂä£Âäø</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">ÊàëÁöÑ‰ºòÂäø</label>
                                        <textarea class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="3" placeholder="ÂàóÂá∫ÊÇ®Âú®ÂÖ≥Á≥ª‰∏≠ÁöÑ‰ºòÂäø..." id="self-advantages"></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">ÊàëÁöÑÂä£Âäø</label>
                                        <textarea class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="3" placeholder="ÂàóÂá∫ÊÇ®ÈúÄË¶ÅÊîπËøõÁöÑÊñπÈù¢..." id="self-disadvantages"></textarea>
                                    </div>
                                </div>
                                <button class="mt-2 btn-secondary px-4 py-2 rounded-md text-sm font-medium" id="save-self-assessment">
                                    <i class="fas fa-save mr-1"></i> ‰øùÂ≠òËá™ÊàëËØÑ‰º∞
                                </button>
                            </div>
                            
                            <div>
                                <h3 class="font-medium mb-2">‰∏™‰∫∫ÁâπË¥®ËØÑ‰º∞</h3>
                                <div class="space-y-4" id="self-assessment-criteria">
                                    <!-- Ëá™ÊàëËØÑ‰º∞Ê†áÂáÜÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                                </div>
                                
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="font-medium">Ëá™ÊàëËØÑ‰º∞ÊÄªÂàÜ</span>
                                        <span class="text-xl font-bold text-primary" id="self-weighted-score">0</span>
                                    </div>
                                    <div class="radar-chart-container">
                                        <canvas id="self-radar-chart"></canvas>
                                    </div>
                                    <div class="mt-4 grid grid-cols-2 gap-2 text-xs" id="self-radar-legend">
                                        <!-- Èõ∑ËææÂõæÂõæ‰æãÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ËØÑ‰º∞Ê†áÂáÜ -->
                        <div class="card p-6">
                            <h2 class="section-title text-lg font-semibold mb-4">
                                <i class="fas fa-list-check text-primary mr-2"></i>
                                ËØÑ‰º∞Ê†áÂáÜ
                            </h2>
                            
                            <div class="space-y-6" id="assessment-criteria">
                                <!-- ËØÑ‰º∞Ê†áÂáÜÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                            </div>
                            
                            <button class="mt-4 btn-primary px-4 py-2 rounded-md text-sm font-medium" id="add-category-btn">
                                <i class="fas fa-plus mr-1"></i> Ê∑ªÂä†ËØÑ‰º∞Â§ßÁ±ª
                            </button>
                        </div>
                        
                        <!-- ÂéüÂàôÁ≥ªÁªü -->
                        <div class="card p-6">
                            <h2 class="section-title text-lg font-semibold mb-4">
                                <i class="fas fa-balance-scale text-primary mr-2"></i>
                                ÂéüÂàôÁ≥ªÁªü
                            </h2>
                            
                            <div class="space-y-4">
                                <div>
                                    <h3 class="font-medium text-danger mb-2">üö´ Á∫¢Á∫øÊ∏ÖÂçï</h3>
                                    <div class="space-y-2" id="red-lines">
                                        <!-- Á∫¢Á∫øÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                                    </div>
                                    <button class="add-item-btn text-sm text-danger mt-2 flex items-center" data-type="red-line">
                                        <i class="fas fa-plus mr-1"></i> Ê∑ªÂä†Á∫¢Á∫ø
                                    </button>
                                </div>
                                
                                <div>
                                    <h3 class="font-medium text-accent mb-2">üìã ÊÅãÁà±ÂáÜÂàô</h3>
                                    <div class="space-y-2" id="relationship-guidelines">
                                        <!-- ÂáÜÂàôÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                                    </div>
                                    <button class="add-item-btn text-sm text-accent mt-2 flex items-center" data-type="guideline">
                                        <i class="fas fa-plus mr-1"></i> Ê∑ªÂä†ÂáÜÂàô
                                    </button>
                                </div>
                                
                                <div>
                                    <h3 class="font-medium text-success mb-2">‚öñÔ∏è ÈùûÂçèÂïÜÊù°Ê¨æ</h3>
                                    <div class="space-y-2" id="non-negotiables">
                                        <!-- ÈùûÂçèÂïÜÊù°Ê¨æÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                                    </div>
                                    <button class="add-item-btn text-sm text-success mt-2 flex items-center" data-type="non-negotiable">
                                        <i class="fas fa-plus mr-1"></i> Ê∑ªÂä†Êù°Ê¨æ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ê°£Ê°àÊäΩÂ±â -->
        <div class="drawer fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-xl z-20 overflow-y-auto">
            <div class="p-4 border-b border-gray-200 sticky top-0 bg-white">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-semibold" id="drawer-title">Êñ∞Âª∫ËØÑ‰º∞ÂØπË±°</h2>
                    <button class="close-drawer p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-times text-gray-500"></i>
                    </button>
                </div>
                
                <!-- Ê†áÁ≠æÂØºËà™ -->
                <div class="tabs flex mt-4 border-b border-gray-200 overflow-x-auto">
                    <button class="tab-btn py-2 px-4 font-medium text-sm border-b-2 border-primary text-primary whitespace-nowrap" data-tab="basic">
                        Âü∫Á°Ä‰ø°ÊÅØ
                    </button>
                    <button class="tab-btn py-2 px-4 font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="assessment">
                        ÂÖ≥Á≥ªËØÑ‰º∞
                    </button>
                    <button class="tab-btn py-2 px-4 font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="interaction">
                        ‰∫íÂä®ËÆ∞ÂΩï
                    </button>
                    <button class="tab-btn py-2 px-4 font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="evaluation">
                        ÁªºÂêàËØÑ‰º∞
                    </button>
                </div>
            </div>
            
            <!-- Ê†áÁ≠æÂÜÖÂÆπ -->
            <div class="p-4">
                <!-- Âü∫Á°Ä‰ø°ÊÅØÊ†áÁ≠æÈ°µ -->
                <div id="tab-basic" class="tab-content active">
                    <form id="basic-info-form">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">ÂßìÂêç</label>
                                <input type="text" id="profile-name" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" placeholder="ËæìÂÖ•ÂßìÂêç" required>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Âπ¥ÈæÑ</label>
                                    <input type="number" id="profile-age" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" placeholder="Âπ¥ÈæÑ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">ËÅå‰∏ö</label>
                                    <input type="text" id="profile-occupation" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" placeholder="ËÅå‰∏ö">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-1">Áõ∏ÈÅáËÉåÊôØ</label>
                                <textarea id="profile-meeting" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="3" placeholder="ÊèèËø∞Â¶Ç‰ΩïËÆ§ËØÜÁöÑÔºåÁ¨¨‰∏ÄÂç∞Ë±°Á≠â"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-1">ËÅîÁ≥ªÊñπÂºè</label>
                                <input type="text" id="profile-contact" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" placeholder="ÁîµËØù/ÂæÆ‰ø°Á≠â">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-1">ÂÖ≥Á≥ªÁ±ªÂûã</label>
                                <div class="flex space-x-4">
                                    <label class="flex items-center">
                                        <input type="radio" name="relationship-type" value="short-term" class="mr-2">
                                        <span>Áü≠ÊúüÂÖ≥Á≥ª</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="relationship-type" value="long-term" class="mr-2" checked>
                                        <span>ÈïøÊúüÂèëÂ±ï</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- ÂÖ≥Á≥ªËØÑ‰º∞Ê†áÁ≠æÈ°µ -->
                <div id="tab-assessment" class="tab-content">
                    <div class="space-y-6">
                        <!-- ÊÄªÂàÜÂíåÈõ∑ËææÂõæÂå∫Âüü -->
                        <div class="card p-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="font-medium text-lg">ÁªºÂêàËØÑÂàÜ</span>
                                <span class="text-2xl font-bold text-primary" id="weighted-score">0</span>
                            </div>
                            <div class="radar-chart-container">
                                <canvas id="radar-chart"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-2 gap-2 text-xs" id="radar-legend">
                                <!-- Èõ∑ËææÂõæÂõæ‰æãÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                            </div>
                        </div>
                        
                        <!-- ÂêÑÈ°πÂæóÂàÜËØ¶ÊÉÖ -->
                        <div id="assessment-criteria-container">
                            <!-- ËØÑ‰º∞Ê†áÂáÜÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                        </div>
                    </div>
                </div>
                
                <!-- ‰∫íÂä®ËÆ∞ÂΩïÊ†áÁ≠æÈ°µ -->
                <div id="tab-interaction" class="tab-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-md font-medium">‰∫íÂä®ËÆ∞ÂΩï</h3>
                        <button class="btn-primary px-3 py-1 rounded-md text-sm flex items-center" id="add-interaction-btn">
                            <i class="fas fa-plus mr-1"></i> Ê∑ªÂä†ËÆ∞ÂΩï
                        </button>
                    </div>
                    
                    <div class="space-y-4" id="interaction-list">
                        <!-- ‰∫íÂä®ËÆ∞ÂΩïÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
                
                <!-- ÁªºÂêàËØÑ‰º∞Ê†áÁ≠æÈ°µ -->
                <div id="tab-evaluation" class="tab-content">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Ê†∏ÂøÉ‰ºòÂäø</label>
                            <textarea id="evaluation-strengths" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="3" placeholder="ÂàóÂá∫ÂØπÊñπÁöÑ3-5‰∏™Ê†∏ÂøÉ‰ºòÂäø"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">‰∏ªË¶ÅÁº∫ÁÇπ</label>
                            <textarea id="evaluation-weaknesses" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="2" placeholder="ÂàóÂá∫1-3‰∏™‰∏ªË¶ÅÁº∫ÁÇπ"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Âê∏ÂºïÂäõÂàÜÊûê</label>
                            <textarea id="evaluation-attractions" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="2" placeholder="ÂàÜÊûêÂØπÊñπÂê∏Âºï‰Ω†ÁöÑÊ†∏ÂøÉÁâπË¥®"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">ÊΩúÂú®È£éÈô©</label>
                            <textarea id="evaluation-risks" class="w-full p-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary" rows="2" placeholder="ËØÜÂà´ÂÖ≥Á≥ª‰∏≠ÂèØËÉΩÂ≠òÂú®ÁöÑÈ£éÈô©"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Â∫ïÈÉ®Êìç‰ΩúÊåâÈíÆ -->
            <div class="p-4 border-t border-gray-200 sticky bottom-0 bg-white">
                <button id="save-profile" class="w-full btn-primary py-2 rounded-md font-medium">
                    ‰øùÂ≠òÊ°£Ê°à
                </button>
            </div>
        </div>
    </div>

    <script>
        // Â∫îÁî®Áä∂ÊÄÅ
        let appState = {
            profiles: [],
            personalInfo: {
                name: '',
                age: '',
                ideal: '',
                selfAssessment: {
                    advantages: '',
                    disadvantages: '',
                    criteriaScores: []
                },
                categories: [
                    {
                        id: 'communication',
                        name: 'Ê≤üÈÄöËÉΩÂäõ',
                        weight: 30,
                        criteria: [
                            { id: 'communication-initiative', name: 'Ê≤üÈÄöÁßØÊûÅÊÄß', description: '‰∏ªÂä®ÂèëËµ∑ÂØπËØù„ÄÅÂõûÂ∫îÂèäÊó∂ÊÄß', weight: 5 },
                            { id: 'listening-skills', name: 'ÂÄæÂê¨ÁêÜËß£ËÉΩÂäõ', description: 'ÊòØÂê¶‰∏ìÊ≥®ÂÄæÂê¨„ÄÅËÉΩÂê¶ÁêÜËß£‰Ω†ÁöÑÊÑüÂèó', weight: 5 },
                            { id: 'emotional-stability', name: 'ÊÉÖÁª™Á®≥ÂÆöÊÄß', description: 'ÊÉÖÁª™Ê≥¢Âä®È¢ëÁéá„ÄÅÊäóÂéãËÉΩÂäõ', weight: 5 }
                        ]
                    },
                    {
                        id: 'values',
                        name: '‰ª∑ÂÄºËßÇ‰∏éÂìÅË¥®',
                        weight: 40,
                        criteria: [
                            { id: 'honesty', name: 'ËØöÂÆûÈÄèÊòé', description: '‰ø°ÊÅØÁúüÂÆûÊÄß„ÄÅÂù¶ËØöÊ≤üÈÄöÊÑèÊÑø', weight: 5 },
                            { id: 'respect-boundaries', name: 'ËæπÁïåÂ∞äÈáç', description: 'Â∞äÈáç‰∏™‰∫∫Á©∫Èó¥„ÄÅÁêÜËß£ÈúÄÊ±Ç', weight: 5 },
                            { id: 'responsibility', name: 'Ë¥£‰ªªÊÑü', description: 'ÊâøËØ∫Â±•Ë°å„ÄÅÈóÆÈ¢òËß£ÂÜ≥‰∏ªÂä®ÊÄß', weight: 5 }
                        ]
                    },
                    {
                        id: 'relationship',
                        name: 'ÂÖ≥Á≥ªÂ§ÑÁêÜ',
                        weight: 30,
                        criteria: [
                            { id: 'cold-violence-tendency', name: 'ÂÜ∑Êö¥ÂäõÂÄæÂêë', description: 'ÂÜ≤Á™ÅÂêéÂ§ÑÁêÜÊñπÂºè„ÄÅÊ≤âÈªòÊåÅÁª≠Êó∂Èó¥', weight: 5, isCritical: true },
                            { id: 'hot-cold-pattern', name: 'ÂøΩÂÜ∑ÂøΩÁÉ≠Ê®°Âºè', description: 'ÁÉ≠ÊÉÖ‰∏éÂÜ∑Ê∑°ÁöÑÂàáÊç¢È¢ëÁéá', weight: 5 },
                            { id: 'conflict-resolution', name: 'ÂÜ≤Á™ÅËß£ÂÜ≥Ê®°Âºè', description: '‰∫âÂêµÊó∂ÁöÑË°®Áé∞„ÄÅËß£ÂÜ≥ÈóÆÈ¢òÁöÑÊñπÂºè', weight: 5 }
                        ]
                    }
                ],
                redLines: ['ÂÜ∑Êö¥Âäõ', 'Ê¨∫È™ó', '‰∏çÂ∞äÈáçËæπÁïå'],
                guidelines: ['ÂÆöÊúüÊ∑±Â∫¶Ê≤üÈÄö', 'ÂêµÊû∂‰∏çËøáÂ§ú', '‰øùÊåÅ‰∏™‰∫∫Á©∫Èó¥'],
                nonNegotiables: ['ÊÉÖÁª™Á®≥ÂÆö', 'ËØöÂÆûÈÄèÊòé', '‰ª∑ÂÄºËßÇ‰∏ÄËá¥']
            },
            currentProfile: null,
            sortOrder: 'score-desc'
        };

        // DOM ÂÖÉÁ¥†
        const appContainer = document.querySelector('.app-container');
        const toggleSidebarBtn = document.querySelector('.toggle-sidebar');
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const drawer = document.querySelector('.drawer');
        const closeDrawerBtn = document.querySelector('.close-drawer');
        const addProfileBtns = document.querySelectorAll('#add-profile-btn, #empty-add-btn');
        const profilesContainer = document.getElementById('profiles-container');
        const emptyState = document.getElementById('empty-state');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const saveProfileBtn = document.getElementById('save-profile');
        const addInteractionBtn = document.getElementById('add-interaction-btn');
        const interactionList = document.getElementById('interaction-list');
        const radarChartCanvas = document.getElementById('radar-chart');
        const selfRadarChartCanvas = document.getElementById('self-radar-chart');
        const assessmentCriteriaContainer = document.getElementById('assessment-criteria-container');
        const personalCriteriaContainer = document.getElementById('assessment-criteria');
        const selfAssessmentContainer = document.getElementById('self-assessment-criteria');
        const addCategoryBtn = document.getElementById('add-category-btn');
        const savePersonalInfoBtn = document.getElementById('save-personal-info');
        const saveSelfAssessmentBtn = document.getElementById('save-self-assessment');
        const addItemBtns = document.querySelectorAll('.add-item-btn');
        const sortProfilesSelect = document.getElementById('sort-profiles');

        // ÂàùÂßãÂåñ
        function init() {
            loadData();
            renderProfiles();
            setupEventListeners();
            renderPersonalCategories();
            renderSelfAssessment();
            renderPersonalPrinciples();
            updateEmptyState();
            
            // ÁßªÂä®Á´ØÊ£ÄÊµãÂíå‰ºòÂåñ
            if (isMobileDevice()) {
                optimizeForMobile();
            }
        }

        // Ê£ÄÊµãÁßªÂä®ËÆæÂ§á
        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
        }

        // ÁßªÂä®Á´Ø‰ºòÂåñ
        function optimizeForMobile() {
            // Ëá™Âä®ÊäòÂè†‰æßËæπÊ†è
            appContainer.classList.add('collapsed');
            
            // Ë∞ÉÊï¥‰∏Ä‰∫õËß¶Êë∏‰∫§‰∫í
            document.addEventListener('touchstart', function() {}, {passive: true});
        }

        // ‰ªélocalStorageÂä†ËΩΩÊï∞ÊçÆ
        function loadData() {
            const savedProfiles = localStorage.getItem('relationiq-profiles');
            const savedPersonalInfo = localStorage.getItem('relationiq-personal');
            const savedSortOrder = localStorage.getItem('relationiq-sort');
            
            if (savedProfiles) {
                appState.profiles = JSON.parse(savedProfiles);
            }
            
            if (savedPersonalInfo) {
                appState.personalInfo = { ...appState.personalInfo, ...JSON.parse(savedPersonalInfo) };
                // Êõ¥Êñ∞‰∏™‰∫∫‰∏≠ÂøÉË°®Âçï
                document.getElementById('personal-name').value = appState.personalInfo.name || '';
                document.getElementById('personal-age').value = appState.personalInfo.age || '';
                document.getElementById('personal-ideal').value = appState.personalInfo.ideal || '';
                document.getElementById('self-advantages').value = appState.personalInfo.selfAssessment.advantages || '';
                document.getElementById('self-disadvantages').value = appState.personalInfo.selfAssessment.disadvantages || '';
            }
            
            if (savedSortOrder) {
                appState.sortOrder = savedSortOrder;
                sortProfilesSelect.value = savedSortOrder;
            }
        }

        // ‰øùÂ≠òÊï∞ÊçÆÂà∞localStorage
        function saveData() {
            localStorage.setItem('relationiq-profiles', JSON.stringify(appState.profiles));
            localStorage.setItem('relationiq-personal', JSON.stringify(appState.personalInfo));
            localStorage.setItem('relationiq-sort', appState.sortOrder);
        }

        // Ê∏≤ÊüìÂØπË±°Âç°Áâá
        function renderProfiles() {
            profilesContainer.innerHTML = '';
            
            if (appState.profiles.length === 0) {
                return;
            }
            
            // Ê†πÊçÆÊéíÂ∫èÊñπÂºèÂØπÂØπË±°ËøõË°åÊéíÂ∫è
            const sortedProfiles = [...appState.profiles];
            
            switch(appState.sortOrder) {
                case 'score-desc':
                    sortedProfiles.sort((a, b) => (b.assessment?.weightedScore || 0) - (a.assessment?.weightedScore || 0));
                    break;
                case 'score-asc':
                    sortedProfiles.sort((a, b) => (a.assessment?.weightedScore || 0) - (b.assessment?.weightedScore || 0));
                    break;
                case 'date-desc':
                    sortedProfiles.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                case 'date-asc':
                    sortedProfiles.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                    break;
                case 'custom':
                    // ‰øùÊåÅÂéüÈ°∫Â∫è
                    break;
            }
            
            sortedProfiles.forEach(profile => {
                const card = document.createElement('div');
                card.className = 'profile-card rounded-lg border border-gray-200 p-4 cursor-pointer relative';
                card.setAttribute('data-id', profile.id);
                
                const timeAgo = getTimeAgo(profile.updatedAt);
                const riskLevel = calculateRiskLevel(profile);
                const riskClass = `risk-${riskLevel}`;
                const totalScore = profile.assessment?.weightedScore || 0;
                
                card.innerHTML = `
                    <!-- Âà†Èô§ÊåâÈíÆ -->
                    <button class="delete-profile absolute top-2 right-2 p-1 rounded-full bg-gray-100 text-gray-500 hover:bg-red-100 hover:text-red-500 transition-colors z-10" data-id="${profile.id}">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                    
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center mr-3">
                            <span class="text-white font-semibold">${profile.name.charAt(0)}</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-medium">${profile.name}</h3>
                                    <span class="inline-block px-2 py-1 text-xs ${
                                        profile.relationshipType === 'long-term' 
                                            ? 'bg-primary text-white' 
                                            : 'bg-secondary text-white'
                                    } rounded-full mt-1">
                                        ${profile.relationshipType === 'long-term' 
                                            ? `ÈïøÊúüÂèëÂ±ï ¬∑ ${totalScore}ÂàÜ` 
                                            : `Áü≠ÊúüÂÖ≥Á≥ª`}
                                    </span>
                                </div>
                                <span class="text-xs text-gray-500">${timeAgo}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">${
                                profile.evaluation?.strengths?.[0] || 'ÊöÇÊó†ËØÑ‰º∞'
                            }</p>
                            <div class="flex justify-between items-center mt-3">
                                <span class="${riskClass} px-2 py-1 text-xs rounded-full">${
                                    riskLevel === 'high' ? 'È´òÈ£éÈô©' : 
                                    riskLevel === 'medium' ? '‰∏≠È£éÈô©' : '‰ΩéÈ£éÈô©'
                                }</span>
                                <span class="text-xs text-gray-500">${profile.interactionLogs?.length || 0}Ê¨°‰∫íÂä®</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÊâìÂºÄÊ°£Ê°à
                card.addEventListener('click', (e) => {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂà†Èô§ÊåâÈíÆÔºåÂàô‰∏çÊâìÂºÄÊ°£Ê°à
                    if (!e.target.closest('.delete-profile')) {
                        openProfile(profile);
                    }
                });
                
                // Ê∑ªÂä†Âà†Èô§‰∫ã‰ª∂
                const deleteBtn = card.querySelector('.delete-profile');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°ÔºåÈÅøÂÖçËß¶ÂèëÂç°ÁâáÁÇπÂáª‰∫ã‰ª∂
                    deleteProfile(profile.id);
                });
                
                profilesContainer.appendChild(card);
            });
        }

        // Âà†Èô§ÂØπË±°
        function deleteProfile(profileId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËØÑ‰º∞ÂØπË±°ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) {
                // ‰ªéÊï∞ÁªÑ‰∏≠ÁßªÈô§ÂØπË±°
                appState.profiles = appState.profiles.filter(profile => profile.id !== profileId);
                
                // ‰øùÂ≠òÊï∞ÊçÆ
                saveData();
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂØπË±°ÂàóË°®
                renderProfiles();
                updateEmptyState();
                
                // Â¶ÇÊûúÂΩìÂâçÊâìÂºÄÁöÑÂØπË±°Ë¢´Âà†Èô§ÔºåÂàôÂÖ≥Èó≠ÊäΩÂ±â
                if (appState.currentProfile && appState.currentProfile.id === profileId) {
                    closeDrawer();
                }
            }
        }

        // ËÆ°ÁÆóÈ£éÈô©Á≠âÁ∫ß
        function calculateRiskLevel(profile) {
            if (!profile.assessment || !profile.assessment.criteriaScores) {
                return 'low';
            }
            
            const totalScore = profile.assessment.weightedScore || 0;
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÖ≥ÈîÆÊåáÊ†áÂæóÂàÜ‰Ωé‰∫é2ÂàÜ
            const hasCriticalLowScore = profile.assessment.criteriaScores.some(score => {
                const criterion = findCriterionById(score.id);
                return criterion && criterion.isCritical && score.score < 2;
            });
            
            // Ê£ÄÊü•‰ΩéÂàÜÊåáÊ†áÊï∞ÈáèÔºà3ÂàÜ‰ª•‰∏ãÔºâ
            const lowScoreCount = profile.assessment.criteriaScores.filter(score => score.score < 3).length;
            
            if (hasCriticalLowScore || totalScore < 60) {
                return 'high';
            } else if (lowScoreCount > 2 || totalScore < 75) {
                return 'medium';
            } else {
                return 'low';
            }
        }

        // Ê†πÊçÆIDÊü•ÊâæËØÑ‰º∞Ê†áÂáÜ
        function findCriterionById(id) {
            for (const category of appState.personalInfo.categories) {
                for (const criterion of category.criteria) {
                    if (criterion.id === id) {
                        return criterion;
                    }
                }
            }
            return null;
        }

        // ÊâìÂºÄÊ°£Ê°à
        function openProfile(profile) {
            appState.currentProfile = profile;
            
            // Â°´ÂÖÖË°®ÂçïÊï∞ÊçÆ
            document.getElementById('profile-name').value = profile.name || '';
            document.getElementById('profile-age').value = profile.age || '';
            document.getElementById('profile-occupation').value = profile.occupation || '';
            document.getElementById('profile-meeting').value = profile.meetingContext || '';
            document.getElementById('profile-contact').value = profile.contact || '';
            
            // ËÆæÁΩÆÂÖ≥Á≥ªÁ±ªÂûã
            document.querySelector(`input[name="relationship-type"][value="${profile.relationshipType}"]`).checked = true;
            
            // ËÆæÁΩÆËØÑ‰º∞Êï∞ÊçÆ
            renderAssessmentCriteria(profile);
            
            // ËÆæÁΩÆÁªºÂêàËØÑ‰º∞
            document.getElementById('evaluation-strengths').value = profile.evaluation?.strengths?.join('\n') || '';
            document.getElementById('evaluation-weaknesses').value = profile.evaluation?.weaknesses?.join('\n') || '';
            document.getElementById('evaluation-attractions').value = profile.evaluation?.attractions?.join('\n') || '';
            document.getElementById('evaluation-risks').value = profile.evaluation?.risks?.join('\n') || '';
            
            // ËÆæÁΩÆ‰∫íÂä®Êó•Âøó
            renderInteractionLogs(profile.interactionLogs || []);
            
            // Êõ¥Êñ∞ÊäΩÂ±âÊ†áÈ¢ò
            document.getElementById('drawer-title').textContent = profile.name;
            
            // ÊâìÂºÄÊäΩÂ±â
            openDrawer();
        }

        // Ê∏≤ÊüìËØÑ‰º∞Ê†áÂáÜ
        function renderAssessmentCriteria(profile = null) {
            assessmentCriteriaContainer.innerHTML = '';
            
            appState.personalInfo.categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'card p-4 mb-4';
                
                let categoryHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">${category.name}</h3>
                        <span class="text-sm text-gray-500">ÊùÉÈáç: ${category.weight}%</span>
                    </div>
                    <div class="sub-criteria">
                `;
                
                category.criteria.forEach(criterion => {
                    // Ëé∑ÂèñËØ•Ê†áÂáÜÁöÑËØÑÂàÜÊï∞ÊçÆ
                    const profileScore = profile?.assessment?.criteriaScores?.find(s => s.id === criterion.id);
                    
                    categoryHTML += `
                        <div class="criteria-item p-3 border border-gray-200 rounded-lg mb-3">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <span class="font-medium">${criterion.name}</span>
                                    <p class="text-xs text-gray-500 mt-1">${criterion.description}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <select class="score-select text-sm border rounded p-1" data-criterion="${criterion.id}">
                                        <option value="0">Êú™ËØÑÂàÜ</option>
                                        <option value="1" ${profileScore?.score === 1 ? 'selected' : ''}>1ÂàÜ</option>
                                        <option value="2" ${profileScore?.score === 2 ? 'selected' : ''}>2ÂàÜ</option>
                                        <option value="3" ${profileScore?.score === 3 ? 'selected' : ''}>3ÂàÜ</option>
                                        <option value="4" ${profileScore?.score === 4 ? 'selected' : ''}>4ÂàÜ</option>
                                        <option value="5" ${profileScore?.score === 5 ? 'selected' : ''}>5ÂàÜ</option>
                                    </select>
                                </div>
                            </div>
                            <textarea class="evidence-input w-full p-2 border border-gray-300 rounded-md text-sm" rows="2" 
                                      placeholder="ËÆ∞ÂΩïÂÖ∑‰ΩìËØÅÊçÆ..." data-criterion="${criterion.id}">${profileScore?.evidence || ''}</textarea>
                        </div>
                    `;
                });
                
                categoryHTML += `</div>`;
                categoryElement.innerHTML = categoryHTML;
                assessmentCriteriaContainer.appendChild(categoryElement);
            });
            
            // Ê∑ªÂä†ËØÑÂàÜ‰∫ã‰ª∂ÁõëÂê¨
            document.querySelectorAll('.score-select').forEach(select => {
                select.addEventListener('change', updateWeightedScore);
            });
            
            document.querySelectorAll('.evidence-input').forEach(textarea => {
                textarea.addEventListener('input', updateWeightedScore);
            });
            
            // Êõ¥Êñ∞Âä†ÊùÉÂàÜÊï∞ÂíåÈõ∑ËææÂõæ
            updateWeightedScore();
        }

        // Êõ¥Êñ∞Âä†ÊùÉÂàÜÊï∞
        function updateWeightedScore() {
            let totalScore = 0;
            let totalPossibleScore = 0;
            const categoryScores = [];
            const categoryNames = [];
            
            appState.personalInfo.categories.forEach(category => {
                const categoryWeight = category.weight / 100; // ËΩ¨Êç¢‰∏∫Â∞èÊï∞
                let categoryTotalScore = 0;
                let categoryPossibleScore = 0;
                let hasScores = false;
                
                category.criteria.forEach(criterion => {
                    const scoreSelect = document.querySelector(`.score-select[data-criterion="${criterion.id}"]`);
                    const score = parseInt(scoreSelect.value) || 0;
                    
                    if (score > 0) {
                        hasScores = true;
                        // ÊØè‰∏™Â∞èÈ°πÂú®ÊâÄÂ±ûÂ§ßÁ±ª‰∏≠ÁöÑÊùÉÈáçÊØî‰æã
                        const criterionWeight = criterion.weight / category.criteria.reduce((sum, c) => sum + c.weight, 0);
                        const weightedScore = score * categoryWeight * criterionWeight * 20; // ËΩ¨Êç¢‰∏∫100ÂàÜÂà∂
                        
                        totalScore += weightedScore;
                        categoryTotalScore += score;
                    }
                    
                    // ËÆ°ÁÆóÊª°ÂàÜÊÉÖÂÜµ‰∏ãÁöÑÂèØËÉΩÂæóÂàÜ
                    const maxScore = 5;
                    const maxCriterionWeight = criterion.weight / category.criteria.reduce((sum, c) => sum + c.weight, 0);
                    totalPossibleScore += maxScore * categoryWeight * maxCriterionWeight * 20;
                    categoryPossibleScore += maxScore;
                });
                
                // ËÆ°ÁÆóÂ§ßÁ±ªÂπ≥ÂùáÂàÜÔºàÂ¶ÇÊûúÊúâËØÑÂàÜÁöÑËØùÔºâ
                if (hasScores) {
                    const categoryAvgScore = categoryTotalScore / category.criteria.length;
                    categoryScores.push(categoryAvgScore);
                    categoryNames.push(category.name);
                }
            });
            
            const weightedScore = totalPossibleScore > 0 ? Math.round(totalScore) : 0;
            document.getElementById('weighted-score').textContent = weightedScore;
            
            // Êõ¥Êñ∞Èõ∑ËææÂõæ - Áé∞Âú®‰ΩøÁî®Â§ßÁ±ªÊï∞ÊçÆ
            updateRadarChart(categoryScores, categoryNames);
        }

        // Êõ¥Êñ∞Èõ∑ËææÂõæ - ÊåâÂ§ßÁ±ªÁªòÂà∂
        function updateRadarChart(scores, names) {
            const ctx = radarChartCanvas.getContext('2d');
            
            // Ê∏ÖÈô§ÁîªÂ∏É
            ctx.clearRect(0, 0, radarChartCanvas.width, radarChartCanvas.height);
            
            if (scores.length === 0) {
                // Â¶ÇÊûúÊ≤°ÊúâÊï∞ÊçÆÔºåÊòæÁ§∫ÊèêÁ§∫
                ctx.fillStyle = '#9CA3AF';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ËØ∑ÂÖàËøõË°åËØÑ‰º∞‰ª•ÁîüÊàêÈõ∑ËææÂõæ', radarChartCanvas.width / 2, radarChartCanvas.height / 2);
                return;
            }
            
            // ËÆæÁΩÆÈõ∑ËææÂõæÂ∞∫ÂØ∏
            const centerX = radarChartCanvas.width / 2;
            const centerY = radarChartCanvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.7;
            
            // ÁªòÂà∂ÁΩëÊ†ºÂíåÂàªÂ∫¶
            ctx.strokeStyle = '#E2E8F0';
            ctx.lineWidth = 1;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = '10px Arial';
            
            // ÁªòÂà∂5‰∏™ÂêåÂøÉÂúÜ
            for (let i = 1; i <= 5; i++) {
                const r = radius * i / 5;
                ctx.beginPath();
                ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
                ctx.stroke();
                
                // Ê∑ªÂä†ÂàªÂ∫¶Ê†áÁ≠æ
                ctx.fillStyle = '#94A3B8';
                ctx.fillText(i.toString(), centerX, centerY - r - 5);
            }
            
            // ÁªòÂà∂Áª¥Â∫¶Á∫ø
            const angleStep = (Math.PI * 2) / names.length;
            ctx.strokeStyle = '#CBD5E1';
            
            for (let i = 0; i < names.length; i++) {
                const angle = i * angleStep;
                const x = centerX + Math.sin(angle) * radius;
                const y = centerY - Math.cos(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Ê∑ªÂä†Áª¥Â∫¶Ê†áÁ≠æ
                ctx.fillStyle = '#475569';
                const labelX = centerX + Math.sin(angle) * (radius + 25);
                const labelY = centerY - Math.cos(angle) * (radius + 25);
                ctx.fillText(names[i], labelX, labelY);
            }
            
            // ÁªòÂà∂Êï∞ÊçÆÂ§öËæπÂΩ¢
            ctx.fillStyle = 'rgba(154, 140, 152, 0.2)';
            ctx.strokeStyle = 'rgb(154, 140, 152)';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            for (let i = 0; i < scores.length; i++) {
                const angle = i * angleStep;
                const r = radius * scores[i] / 5; // Â∞ÜÂàÜÊï∞ËΩ¨Êç¢‰∏∫ÂçäÂæÑÊØî‰æã
                const x = centerX + Math.sin(angle) * r;
                const y = centerY - Math.cos(angle) * r;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // ÁªòÂà∂Êï∞ÊçÆÁÇπ
            ctx.fillStyle = 'rgb(154, 140, 152)';
            for (let i = 0; i < scores.length; i++) {
                const angle = i * angleStep;
                const r = radius * scores[i] / 5;
                const x = centerX + Math.sin(angle) * r;
                const y = centerY - Math.cos(angle) * r;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Êõ¥Êñ∞Âõæ‰æã
            updateRadarLegend(scores, names);
        }

        // Êõ¥Êñ∞Èõ∑ËææÂõæÂõæ‰æã
        function updateRadarLegend(scores, names) {
            const legendContainer = document.getElementById('radar-legend');
            legendContainer.innerHTML = '';
            
            names.forEach((name, index) => {
                const score = scores[index] || 0;
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center';
                legendItem.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-primary mr-2"></div>
                    <span class="flex-1 truncate">${name}</span>
                    <span class="font-medium ml-2">${score.toFixed(1)}/5</span>
                `;
                legendContainer.appendChild(legendItem);
            });
        }

        // Ê∏≤ÊüìËá™ÊàëËØÑ‰º∞
        function renderSelfAssessment() {
            selfAssessmentContainer.innerHTML = '';
            
            appState.personalInfo.categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'card p-4 mb-4';
                
                let categoryHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">${category.name}</h3>
                        <span class="text-sm text-gray-500">ÊùÉÈáç: ${category.weight}%</span>
                    </div>
                    <div class="sub-criteria">
                `;
                
                category.criteria.forEach(criterion => {
                    // Ëé∑ÂèñËØ•Ê†áÂáÜÁöÑËØÑÂàÜÊï∞ÊçÆ
                    const selfScore = appState.personalInfo.selfAssessment.criteriaScores?.find(s => s.id === criterion.id);
                    
                    categoryHTML += `
                        <div class="criteria-item p-3 border border-gray-200 rounded-lg mb-3">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <span class="font-medium">${criterion.name}</span>
                                    <p class="text-xs text-gray-500 mt-1">${criterion.description}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <select class="self-score-select text-sm border rounded p-1" data-criterion="${criterion.id}">
                                        <option value="0">Êú™ËØÑÂàÜ</option>
                                        <option value="1" ${selfScore?.score === 1 ? 'selected' : ''}>1ÂàÜ</option>
                                        <option value="2" ${selfScore?.score === 2 ? 'selected' : ''}>2ÂàÜ</option>
                                        <option value="3" ${selfScore?.score === 3 ? 'selected' : ''}>3ÂàÜ</option>
                                        <option value="4" ${selfScore?.score === 4 ? 'selected' : ''}>4ÂàÜ</option>
                                        <option value="5" ${selfScore?.score === 5 ? 'selected' : ''}>5ÂàÜ</option>
                                    </select>
                                </div>
                            </div>
                            <textarea class="self-evidence-input w-full p-2 border border-gray-300 rounded-md text-sm" rows="2" 
                                      placeholder="ËÆ∞ÂΩïÂÖ∑‰ΩìËØÅÊçÆ..." data-criterion="${criterion.id}">${selfScore?.evidence || ''}</textarea>
                        </div>
                    `;
                });
                
                categoryHTML += `</div>`;
                categoryElement.innerHTML = categoryHTML;
                selfAssessmentContainer.appendChild(categoryElement);
            });
            
            // Ê∑ªÂä†ËØÑÂàÜ‰∫ã‰ª∂ÁõëÂê¨
            document.querySelectorAll('.self-score-select').forEach(select => {
                select.addEventListener('change', updateSelfWeightedScore);
            });
            
            document.querySelectorAll('.self-evidence-input').forEach(textarea => {
                textarea.addEventListener('input', updateSelfWeightedScore);
            });
            
            // Êõ¥Êñ∞Âä†ÊùÉÂàÜÊï∞ÂíåÈõ∑ËææÂõæ
            updateSelfWeightedScore();
        }

        // Êõ¥Êñ∞Ëá™ÊàëËØÑ‰º∞Âä†ÊùÉÂàÜÊï∞
        function updateSelfWeightedScore() {
            let totalScore = 0;
            let totalPossibleScore = 0;
            const categoryScores = [];
            const categoryNames = [];
            
            appState.personalInfo.categories.forEach(category => {
                const categoryWeight = category.weight / 100; // ËΩ¨Êç¢‰∏∫Â∞èÊï∞
                let categoryTotalScore = 0;
                let categoryPossibleScore = 0;
                let hasScores = false;
                
                category.criteria.forEach(criterion => {
                    const scoreSelect = document.querySelector(`.self-score-select[data-criterion="${criterion.id}"]`);
                    const score = parseInt(scoreSelect.value) || 0;
                    
                    if (score > 0) {
                        hasScores = true;
                        // ÊØè‰∏™Â∞èÈ°πÂú®ÊâÄÂ±ûÂ§ßÁ±ª‰∏≠ÁöÑÊùÉÈáçÊØî‰æã
                        const criterionWeight = criterion.weight / category.criteria.reduce((sum, c) => sum + c.weight, 0);
                        const weightedScore = score * categoryWeight * criterionWeight * 20; // ËΩ¨Êç¢‰∏∫100ÂàÜÂà∂
                        
                        totalScore += weightedScore;
                        categoryTotalScore += score;
                    }
                    
                    // ËÆ°ÁÆóÊª°ÂàÜÊÉÖÂÜµ‰∏ãÁöÑÂèØËÉΩÂæóÂàÜ
                    const maxScore = 5;
                    const maxCriterionWeight = criterion.weight / category.criteria.reduce((sum, c) => sum + c.weight, 0);
                    totalPossibleScore += maxScore * categoryWeight * maxCriterionWeight * 20;
                    categoryPossibleScore += maxScore;
                });
                
                // ËÆ°ÁÆóÂ§ßÁ±ªÂπ≥ÂùáÂàÜÔºàÂ¶ÇÊûúÊúâËØÑÂàÜÁöÑËØùÔºâ
                if (hasScores) {
                    const categoryAvgScore = categoryTotalScore / category.criteria.length;
                    categoryScores.push(categoryAvgScore);
                    categoryNames.push(category.name);
                }
            });
            
            const weightedScore = totalPossibleScore > 0 ? Math.round(totalScore) : 0;
            document.getElementById('self-weighted-score').textContent = weightedScore;
            
            // Êõ¥Êñ∞Èõ∑ËææÂõæ - Áé∞Âú®‰ΩøÁî®Â§ßÁ±ªÊï∞ÊçÆ
            updateSelfRadarChart(categoryScores, categoryNames);
        }

        // Êõ¥Êñ∞Ëá™ÊàëËØÑ‰º∞Èõ∑ËææÂõæ - ÊåâÂ§ßÁ±ªÁªòÂà∂
        function updateSelfRadarChart(scores, names) {
            const ctx = selfRadarChartCanvas.getContext('2d');
            
            // Ê∏ÖÈô§ÁîªÂ∏É
            ctx.clearRect(0, 0, selfRadarChartCanvas.width, selfRadarChartCanvas.height);
            
            if (scores.length === 0) {
                // Â¶ÇÊûúÊ≤°ÊúâÊï∞ÊçÆÔºåÊòæÁ§∫ÊèêÁ§∫
                ctx.fillStyle = '#9CA3AF';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ËØ∑ÂÖàËøõË°åËá™ÊàëËØÑ‰º∞‰ª•ÁîüÊàêÈõ∑ËææÂõæ', selfRadarChartCanvas.width / 2, selfRadarChartCanvas.height / 2);
                return;
            }
            
            // ËÆæÁΩÆÈõ∑ËææÂõæÂ∞∫ÂØ∏
            const centerX = selfRadarChartCanvas.width / 2;
            const centerY = selfRadarChartCanvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.7;
            
            // ÁªòÂà∂ÁΩëÊ†ºÂíåÂàªÂ∫¶
            ctx.strokeStyle = '#E2E8F0';
            ctx.lineWidth = 1;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = '10px Arial';
            
            // ÁªòÂà∂5‰∏™ÂêåÂøÉÂúÜ
            for (let i = 1; i <= 5; i++) {
                const r = radius * i / 5;
                ctx.beginPath();
                ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
                ctx.stroke();
                
                // Ê∑ªÂä†ÂàªÂ∫¶Ê†áÁ≠æ
                ctx.fillStyle = '#94A3B8';
                ctx.fillText(i.toString(), centerX, centerY - r - 5);
            }
            
            // ÁªòÂà∂Áª¥Â∫¶Á∫ø
            const angleStep = (Math.PI * 2) / names.length;
            ctx.strokeStyle = '#CBD5E1';
            
            for (let i = 0; i < names.length; i++) {
                const angle = i * angleStep;
                const x = centerX + Math.sin(angle) * radius;
                const y = centerY - Math.cos(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Ê∑ªÂä†Áª¥Â∫¶Ê†áÁ≠æ
                ctx.fillStyle = '#475569';
                const labelX = centerX + Math.sin(angle) * (radius + 25);
                const labelY = centerY - Math.cos(angle) * (radius + 25);
                ctx.fillText(names[i], labelX, labelY);
            }
            
            // ÁªòÂà∂Êï∞ÊçÆÂ§öËæπÂΩ¢
            ctx.fillStyle = 'rgba(201, 173, 167, 0.2)';
            ctx.strokeStyle = 'rgb(201, 173, 167)';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            for (let i = 0; i < scores.length; i++) {
                const angle = i * angleStep;
                const r = radius * scores[i] / 5; // Â∞ÜÂàÜÊï∞ËΩ¨Êç¢‰∏∫ÂçäÂæÑÊØî‰æã
                const x = centerX + Math.sin(angle) * r;
                const y = centerY - Math.cos(angle) * r;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // ÁªòÂà∂Êï∞ÊçÆÁÇπ
            ctx.fillStyle = 'rgb(201, 173, 167)';
            for (let i = 0; i < scores.length; i++) {
                const angle = i * angleStep;
                const r = radius * scores[i] / 5;
                const x = centerX + Math.sin(angle) * r;
                const y = centerY - Math.cos(angle) * r;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Êõ¥Êñ∞Âõæ‰æã
            updateSelfRadarLegend(scores, names);
        }

        // Êõ¥Êñ∞Ëá™ÊàëËØÑ‰º∞Èõ∑ËææÂõæÂõæ‰æã
        function updateSelfRadarLegend(scores, names) {
            const legendContainer = document.getElementById('self-radar-legend');
            legendContainer.innerHTML = '';
            
            names.forEach((name, index) => {
                const score = scores[index] || 0;
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center';
                legendItem.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-secondary mr-2"></div>
                    <span class="flex-1 truncate">${name}</span>
                    <span class="font-medium ml-2">${score.toFixed(1)}/5</span>
                `;
                legendContainer.appendChild(legendItem);
            });
        }

        // Ê∏≤Êüì‰∏™‰∫∫ËØÑ‰º∞Ê†áÂáÜ
        function renderPersonalCategories() {
            personalCriteriaContainer.innerHTML = '';
            
            appState.personalInfo.categories.forEach((category, categoryIndex) => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'card p-4 mb-4';
                categoryElement.setAttribute('data-category-index', categoryIndex);
                
                let categoryHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center">
                            <h3 class="font-medium mr-2">${category.name}</h3>
                            <span class="text-xs bg-primary text-white px-2 py-1 rounded">ÊùÉÈáç: ${category.weight}%</span>
                        </div>
                        <div class="flex space-x-2">
                            <button class="add-subcriterion-btn text-sm text-primary" data-category-index="${categoryIndex}">
                                <i class="fas fa-plus mr-1"></i> Ê∑ªÂä†Â∞èÈ°π
                            </button>
                            <button class="delete-category text-danger" data-category-index="${categoryIndex}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="sub-criteria">
                `;
                
                category.criteria.forEach((criterion, criterionIndex) => {
                    categoryHTML += `
                        <div class="flex justify-between items-center p-3 border border-gray-200 rounded-lg mb-2">
                            <div>
                                <span class="font-medium">${criterion.name}</span>
                                <p class="text-xs text-gray-500">${criterion.description}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs text-gray-500">ÊùÉÈáç: ${criterion.weight}</span>
                                <button class="delete-criterion text-danger" data-category-index="${categoryIndex}" data-criterion-index="${criterionIndex}">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                categoryHTML += `</div>`;
                categoryElement.innerHTML = categoryHTML;
                personalCriteriaContainer.appendChild(categoryElement);
            });
            
            // Ê∑ªÂä†Âà†Èô§‰∫ã‰ª∂
            document.querySelectorAll('.delete-category').forEach(button => {
                button.addEventListener('click', function() {
                    const categoryIndex = parseInt(this.getAttribute('data-category-index'));
                    appState.personalInfo.categories.splice(categoryIndex, 1);
                    saveData();
                    renderPersonalCategories();
                    renderSelfAssessment();
                });
            });
            
            // Ê∑ªÂä†Â∞èÈ°π‰∫ã‰ª∂
            document.querySelectorAll('.add-subcriterion-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const categoryIndex = parseInt(this.getAttribute('data-category-index'));
                    const name = prompt('ËØ∑ËæìÂÖ•Â∞èÈ°πÂêçÁß∞:');
                    if (name) {
                        const description = prompt('ËØ∑ËæìÂÖ•Â∞èÈ°πÊèèËø∞:');
                        appState.personalInfo.categories[categoryIndex].criteria.push({
                            id: 'sub-' + Date.now(),
                            name,
                            description: description || '',
                            weight: 5
                        });
                        saveData();
                        renderPersonalCategories();
                        renderSelfAssessment();
                    }
                });
            });
            
            // Âà†Èô§Â∞èÈ°π‰∫ã‰ª∂
            document.querySelectorAll('.delete-criterion').forEach(button => {
                button.addEventListener('click', function() {
                    const categoryIndex = parseInt(this.getAttribute('data-category-index'));
                    const criterionIndex = parseInt(this.getAttribute('data-criterion-index'));
                    appState.personalInfo.categories[categoryIndex].criteria.splice(criterionIndex, 1);
                    saveData();
                    renderPersonalCategories();
                    renderSelfAssessment();
                });
            });
        }

        // Ê∏≤Êüì‰∏™‰∫∫ÂéüÂàô
        function renderPersonalPrinciples() {
            renderPrinciplesList('red-lines', appState.personalInfo.redLines, 'danger');
            renderPrinciplesList('relationship-guidelines', appState.personalInfo.guidelines, 'accent');
            renderPrinciplesList('non-negotiables', appState.personalInfo.nonNegotiables, 'success');
        }

        // Ê∏≤ÊüìÂéüÂàôÂàóË°®
        function renderPrinciplesList(containerId, items, color) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
                itemElement.innerHTML = `
                    <span>${item}</span>
                    <button class="delete-item text-${color}-600" data-type="${containerId}" data-index="${index}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(itemElement);
            });
            
            // Ê∑ªÂä†Âà†Èô§‰∫ã‰ª∂
            container.querySelectorAll('.delete-item').forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const index = parseInt(this.getAttribute('data-index'));
                    
                    if (type === 'red-lines') {
                        appState.personalInfo.redLines.splice(index, 1);
                    } else if (type === 'relationship-guidelines') {
                        appState.personalInfo.guidelines.splice(index, 1);
                    } else if (type === 'non-negotiables') {
                        appState.personalInfo.nonNegotiables.splice(index, 1);
                    }
                    
                    saveData();
                    renderPersonalPrinciples();
                });
            });
        }

        // ÊâìÂºÄÊäΩÂ±â
        function openDrawer() {
            drawer.classList.add('open');
        }
        
        // ÂÖ≥Èó≠ÊäΩÂ±â
        function closeDrawer() {
            drawer.classList.remove('open');
            appState.currentProfile = null;
            
            // ÈáçÁΩÆË°®Âçï
            document.getElementById('basic-info-form').reset();
            document.querySelector('input[name="relationship-type"][value="long-term"]').checked = true;
            renderAssessmentCriteria();
            interactionList.innerHTML = '<p class="text-gray-500 text-center py-4">ÊöÇÊó†‰∫íÂä®ËÆ∞ÂΩï</p>';
        }
        
        // ÂàáÊç¢Ê†áÁ≠æÈ°µ
        function switchTab(tabName) {
            // Êõ¥Êñ∞Ê†áÁ≠æÊåâÈíÆÁä∂ÊÄÅ
            tabBtns.forEach(btn => {
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('border-primary', 'text-primary');
                    btn.classList.remove('text-gray-500');
                } else {
                    btn.classList.remove('border-primary', 'text-primary');
                    btn.classList.add('text-gray-500');
                }
            });
            
            // Êõ¥Êñ∞Ê†áÁ≠æÂÜÖÂÆπ
            tabContents.forEach(content => {
                if (content.id === `tab-${tabName}`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }
        
        // ÂàáÊç¢È°µÈù¢
        function switchPage(pageName) {
            // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`${pageName}-page`).classList.add('active');
            
            // Êõ¥Êñ∞ÂØºËà™ÊøÄÊ¥ªÁä∂ÊÄÅ
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === pageName) {
                    item.classList.add('active');
                }
            });
        }
        
        // Ëé∑ÂèñÊó∂Èó¥Â∑Æ
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - new Date(date);
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return '‰ªäÂ§©';
            if (diffDays === 1) return 'Êò®Â§©';
            if (diffDays < 7) return `${diffDays}Â§©Ââç`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)}Âë®Ââç`;
            return `${Math.floor(diffDays / 30)}ÊúàÂâç`;
        }
        
        // Êõ¥Êñ∞Á©∫Áä∂ÊÄÅ
        function updateEmptyState() {
            if (appState.profiles.length === 0) {
                emptyState.classList.remove('hidden');
                profilesContainer.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                profilesContainer.classList.remove('hidden');
            }
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨
        function setupEventListeners() {
            // ‰æßËæπÊ†èÂàáÊç¢
            toggleSidebarBtn.addEventListener('click', () => {
                appContainer.classList.toggle('collapsed');
            });
            
            // ÂØºËà™ÂàáÊç¢
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageName = this.getAttribute('data-page');
                    switchPage(pageName);
                });
            });
            
            // Êñ∞Âª∫ÂØπË±°ÊåâÈíÆ
            addProfileBtns.forEach(btn => {
                btn.addEventListener('click', openDrawer);
            });
            
            // ÂÖ≥Èó≠ÊäΩÂ±â
            closeDrawerBtn.addEventListener('click', closeDrawer);
            
            // Ê†áÁ≠æÈ°µÂàáÊç¢
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabName = btn.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Ê∑ªÂä†‰∫íÂä®ËÆ∞ÂΩï
            addInteractionBtn.addEventListener('click', () => {
                const date = prompt('ËØ∑ËæìÂÖ•‰∫íÂä®Êó•Êúü (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
                const type = prompt('ËØ∑ËæìÂÖ•‰∫íÂä®Á±ªÂûã:');
                const importance = prompt('ËØ∑ËæìÂÖ•ÈáçË¶ÅÊÄß (high/medium/low):', 'medium');
                const description = prompt('ËØ∑ËæìÂÖ•‰∫íÂä®ÊèèËø∞:');
                
                if (date && type && importance && description) {
                    const newInteraction = {
                        id: Date.now().toString(),
                        date,
                        type,
                        importance,
                        description
                    };
                    
                    if (!appState.currentProfile.interactionLogs) {
                        appState.currentProfile.interactionLogs = [];
                    }
                    
                    appState.currentProfile.interactionLogs.push(newInteraction);
                    renderInteractionLogs(appState.currentProfile.interactionLogs);
                }
            });
            
            // ‰øùÂ≠òÊ°£Ê°à
            saveProfileBtn.addEventListener('click', () => {
                // Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
                const name = document.getElementById('profile-name').value;
                const age = document.getElementById('profile-age').value;
                const occupation = document.getElementById('profile-occupation').value;
                const meetingContext = document.getElementById('profile-meeting').value;
                const contact = document.getElementById('profile-contact').value;
                const relationshipType = document.querySelector('input[name="relationship-type"]:checked').value;
                
                // Êî∂ÈõÜËØÑ‰º∞Êï∞ÊçÆ
                const criteriaScores = [];
                appState.personalInfo.categories.forEach(category => {
                    category.criteria.forEach(criterion => {
                        const scoreSelect = document.querySelector(`.score-select[data-criterion="${criterion.id}"]`);
                        const evidenceInput = document.querySelector(`.evidence-input[data-criterion="${criterion.id}"]`);
                        
                        const score = parseInt(scoreSelect.value) || 0;
                        
                        if (score > 0) {
                            criteriaScores.push({
                                id: criterion.id,
                                score: score,
                                evidence: evidenceInput.value
                            });
                        }
                    });
                });
                
                // ËÆ°ÁÆóÊÄªÂàÜ
                const weightedScore = parseInt(document.getElementById('weighted-score').textContent);
                
                const assessment = {
                    criteriaScores: criteriaScores,
                    weightedScore: weightedScore
                };
                
                // Êî∂ÈõÜÁªºÂêàËØÑ‰º∞
                const evaluation = {
                    strengths: document.getElementById('evaluation-strengths').value.split('\n').filter(s => s.trim()),
                    weaknesses: document.getElementById('evaluation-weaknesses').value.split('\n').filter(s => s.trim()),
                    attractions: document.getElementById('evaluation-attractions').value.split('\n').filter(s => s.trim()),
                    risks: document.getElementById('evaluation-risks').value.split('\n').filter(s => s.trim())
                };
                
                // ÂàõÂª∫ÊàñÊõ¥Êñ∞Ê°£Ê°à
                const profileData = {
                    name,
                    age: age ? parseInt(age) : undefined,
                    occupation,
                    meetingContext,
                    contact,
                    relationshipType,
                    assessment,
                    evaluation,
                    updatedAt: new Date()
                };
                
                if (appState.currentProfile) {
                    // Êõ¥Êñ∞Áé∞ÊúâÊ°£Ê°à
                    Object.assign(appState.currentProfile, profileData);
                } else {
                    // ÂàõÂª∫Êñ∞Ê°£Ê°à
                    profileData.id = Date.now().toString();
                    profileData.interactionLogs = [];
                    profileData.createdAt = new Date();
                    appState.profiles.push(profileData);
                }
                
                // ‰øùÂ≠òÊï∞ÊçÆ
                saveData();
                
                // Êõ¥Êñ∞UI
                renderProfiles();
                updateEmptyState();
                
                alert('Ê°£Ê°àÂ∑≤‰øùÂ≠òÔºÅ');
                closeDrawer();
            });
            
            // Ê∑ªÂä†ËØÑ‰º∞Â§ßÁ±ª
            addCategoryBtn.addEventListener('click', () => {
                const name = prompt('ËØ∑ËæìÂÖ•ËØÑ‰º∞Â§ßÁ±ªÂêçÁß∞:');
                if (name) {
                    appState.personalInfo.categories.push({
                        id: 'category-' + Date.now(),
                        name,
                        weight: 20,
                        criteria: []
                    });
                    saveData();
                    renderPersonalCategories();
                }
            });
            
            // ‰øùÂ≠ò‰∏™‰∫∫‰ø°ÊÅØ
            savePersonalInfoBtn.addEventListener('click', () => {
                appState.personalInfo.name = document.getElementById('personal-name').value;
                appState.personalInfo.age = document.getElementById('personal-age').value;
                appState.personalInfo.ideal = document.getElementById('personal-ideal').value;
                saveData();
                alert('‰∏™‰∫∫‰ø°ÊÅØÂ∑≤‰øùÂ≠òÔºÅ');
            });
            
            // ‰øùÂ≠òËá™ÊàëËØÑ‰º∞
            saveSelfAssessmentBtn.addEventListener('click', () => {
                appState.personalInfo.selfAssessment.advantages = document.getElementById('self-advantages').value;
                appState.personalInfo.selfAssessment.disadvantages = document.getElementById('self-disadvantages').value;
                
                // Êî∂ÈõÜËá™ÊàëËØÑ‰º∞Êï∞ÊçÆ
                const criteriaScores = [];
                appState.personalInfo.categories.forEach(category => {
                    category.criteria.forEach(criterion => {
                        const scoreSelect = document.querySelector(`.self-score-select[data-criterion="${criterion.id}"]`);
                        const evidenceInput = document.querySelector(`.self-evidence-input[data-criterion="${criterion.id}"]`);
                        
                        const score = parseInt(scoreSelect.value) || 0;
                        
                        if (score > 0) {
                            criteriaScores.push({
                                id: criterion.id,
                                score: score,
                                evidence: evidenceInput.value
                            });
                        }
                    });
                });
                
                appState.personalInfo.selfAssessment.criteriaScores = criteriaScores;
                saveData();
                alert('Ëá™ÊàëËØÑ‰º∞Â∑≤‰øùÂ≠òÔºÅ');
            });
            
            // Ê∑ªÂä†ÂéüÂàôÈ°πÁõÆ
            addItemBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const item = prompt('ËØ∑ËæìÂÖ•ÂÜÖÂÆπ:');
                    if (item) {
                        if (type === 'red-line') {
                            appState.personalInfo.redLines.push(item);
                        } else if (type === 'guideline') {
                            appState.personalInfo.guidelines.push(item);
                        } else if (type === 'non-negotiable') {
                            appState.personalInfo.nonNegotiables.push(item);
                        }
                        saveData();
                        renderPersonalPrinciples();
                    }
                });
            });
            
            // ÊéíÂ∫èÂäüËÉΩ
            sortProfilesSelect.addEventListener('change', function() {
                appState.sortOrder = this.value;
                saveData();
                renderProfiles();
            });
        }

        // Ê∏≤Êüì‰∫íÂä®Êó•Âøó
        function renderInteractionLogs(interactions) {
            interactionList.innerHTML = '';
            
            if (interactions.length === 0) {
                interactionList.innerHTML = '<p class="text-gray-500 text-center py-4">ÊöÇÊó†‰∫íÂä®ËÆ∞ÂΩï</p>';
                return;
            }
            
            interactions.forEach(interaction => {
                const interactionElement = document.createElement('div');
                interactionElement.className = 'interaction-item p-3 border border-gray-200 rounded-lg';
                interactionElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-medium">${interaction.type}</span>
                            <span class="ml-2 text-xs ${
                                interaction.importance === 'high' ? 'bg-danger text-white' :
                                interaction.importance === 'medium' ? 'bg-warning text-white' :
                                'bg-gray-200 text-gray-700'
                            } px-2 py-1 rounded-full">${
                                interaction.importance === 'high' ? 'ÈáçË¶Å' :
                                interaction.importance === 'medium' ? '‰∏≠Á≠â' : '‰∏ÄËà¨'
                            }</span>
                        </div>
                        <span class="text-xs text-gray-500">${interaction.date}</span>
                    </div>
                    <p class="text-sm text-gray-600">${interaction.description}</p>
                `;
                interactionList.appendChild(interactionElement);
            });
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        init();
    </script>
</body>
</html>
